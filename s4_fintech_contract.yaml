# ═══════════════════════════════════════════════════════════════════════════
# DATA CONTRACT: FinTech Transaction Log
# ═══════════════════════════════════════════════════════════════════════════
#
# NEGOTIATION SUMMARY
# ───────────────────
# Producer: Core Banking Systems Team (core-banking@fintech.com)
# Consumer: Fraud Detection Team (fraud-detection@fintech.com)
#
# Agreed Terms:
#   - Account ID format strictly enforced: exactly 10 uppercase alphanumeric chars
#   - Pattern validation using regex: ^[A-Z0-9]{10}$
#   - HARD CIRCUIT BREAKER: Pipeline must halt on any format violation
#   - No soft warnings allowed due to fraud detection criticality
#   - Zero tolerance policy for malformed account IDs
#
# Incident Reference: Legacy system upgrade introduced 8-character account IDs
#                     (instead of required 10), causing fraud model to silently
#                     fail lookups and miss fraudulent transactions
# Contract Purpose: Prevent malformed account IDs from bypassing fraud detection
# Security Classification: CRITICAL - Financial fraud prevention
# Signed off: Core Banking Lead + Fraud Detection Lead + CISO
# ═══════════════════════════════════════════════════════════════════════════


dataContractSpecification: 0.9.3
id: urn:datacontract:fintech:transaction-log
version: 1.0.0


# ───────────────────────────────────────────────────────────────────────────
# 1. OWNERSHIP & GOVERNANCE
# ───────────────────────────────────────────────────────────────────────────
info:
  title: "FinTech Transaction Log"
  description: |
    Real-time transaction records for fraud detection and compliance monitoring.
    Includes source/destination account identifiers and transaction timestamps.
    Primary use: Real-time fraud detection, suspicious activity monitoring,
    regulatory compliance (AML/KYC), and transaction auditing.
    CRITICAL: Account ID format violations can cause fraud detection failures
    and regulatory compliance breaches.
  owner: "Core Banking Systems Team"
  contact:
    name: "Banking Platform Lead"
    email: "banking-platform@fintech.com"
    slack: "#core-banking"
  classification: confidential  # Financial transaction data
  tags: [transactions, fraud-detection, banking, compliance, aml, security]


# ───────────────────────────────────────────────────────────────────────────
# 2. SCHEMA DEFINITION (Logical Contract)
# ───────────────────────────────────────────────────────────────────────────
schema:
  type: object
  properties:

    account_source_id:
      type: string
      pattern: "^[A-Z0-9]{10}$"
      description: |
        Source account identifier (sender).
        STRICT FORMAT: Exactly 10 characters, uppercase letters (A-Z) and 
        digits (0-9) only.
        
        Valid examples:
          ✓ ABCD123456
          ✓ 1234567890
          ✓ A1B2C3D4E5
        
        Invalid examples:
          ✗ abcd1234 (lowercase, too short)
          ✗ ABC_123456 (contains underscore)
          ✗ ABC123 (too short)
          ✗ ABC123456789 (too long)
        
        CRITICAL: Malformed IDs cause fraud model lookup failures.
        Hard enforcement required - no exceptions.
      # physical_mapping: acct_src

    account_destination_id:
      type: string
      pattern: "^[A-Z0-9]{10}$"
      description: |
        Destination account identifier (recipient).
        STRICT FORMAT: Exactly 10 characters, uppercase letters (A-Z) and 
        digits (0-9) only.
        Same validation rules as account_source_id.
      # physical_mapping: acct_dest

    transaction_timestamp:
      type: string
      format: date-time
      description: |
        Transaction execution timestamp (UTC).
        Used for temporal fraud pattern detection and audit trails.
      # physical_mapping: tx_ts

  required:
    - account_source_id
    - account_destination_id
    - transaction_timestamp


# ───────────────────────────────────────────────────────────────────────────
# 3. SERVICE LEVEL AGREEMENTS (SLAs)
# ───────────────────────────────────────────────────────────────────────────
sla:
  freshness:
    threshold: "1 second"
    description: "Real-time streaming required for fraud detection"
  availability:
    percentage: "99.99%"
    description: "Critical uptime for financial transaction processing"
  retention:
    period: "7 years"
    description: "Retained per financial regulatory requirements (SOX, GDPR)"


# ───────────────────────────────────────────────────────────────────────────
# 4. DATA QUALITY RULES
# ───────────────────────────────────────────────────────────────────────────
quality:

  # Rule 1: Source Account ID format validation (HARD CIRCUIT BREAKER)
  - name: account_source_id_format_validation
    type: validity
    expression: "REGEXP_LIKE(account_source_id, '^[A-Z0-9]{10}$')"
    threshold: "100%"
    enforcement: hard
    description: |
      Source account ID must match pattern: exactly 10 uppercase alphanumeric characters.
      
      ⚠️  HARD CIRCUIT BREAKER ENABLED ⚠️
      
      This rule MUST block the pipeline on any violation. No soft warnings allowed.
      
      Rationale: Malformed account IDs cause fraud detection model to silently fail
      lookups, resulting in missed fraudulent transactions and regulatory violations.
      
      Any record with invalid format will be REJECTED and pipeline will HALT.
      
      Emergency contact: fraud-detection@fintech.com

  # Rule 2: Destination Account ID format validation (HARD CIRCUIT BREAKER)
  - name: account_destination_id_format_validation
    type: validity
    expression: "REGEXP_LIKE(account_destination_id, '^[A-Z0-9]{10}$')"
    threshold: "100%"
    enforcement: hard
    description: |
      Destination account ID must match pattern: exactly 10 uppercase alphanumeric characters.
      
      ⚠️  HARD CIRCUIT BREAKER ENABLED ⚠️
      
      Same strict enforcement as source account ID.
      Pipeline MUST halt on any format violation.

  # Rule 3: Source account ID completeness
  - name: account_source_id_not_null
    type: completeness
    column: account_source_id
    threshold: "100%"
    enforcement: hard
    description: "Source account identifier is required for all transactions"

  # Rule 4: Destination account ID completeness
  - name: account_destination_id_not_null
    type: completeness
    column: account_destination_id
    threshold: "100%"
    enforcement: hard
    description: "Destination account identifier is required for all transactions"

  # Rule 5: Transaction timestamp completeness
  - name: transaction_timestamp_not_null
    type: completeness
    column: transaction_timestamp
    threshold: "100%"
    enforcement: hard
    description: "Transaction timestamp required for audit trail and fraud detection"

  # Rule 6: Transaction timestamp not in future
  - name: transaction_timestamp_not_future
    type: validity
    expression: "transaction_timestamp <= CURRENT_TIMESTAMP"
    threshold: "100%"
    enforcement: hard
    description: "Transaction timestamp cannot be in the future (data integrity check)"


# ───────────────────────────────────────────────────────────────────────────
# 5. LINEAGE & CONSUMERS
# ───────────────────────────────────────────────────────────────────────────
lineage:
  sources:
    - name: core_banking_system
      type: postgresql
      table: tx_log
      description: "Core banking transaction processing system"
  consumers:
    - name: fraud-detection-engine
      team: fraud-detection
      usage: "Real-time fraud pattern detection and suspicious activity alerts"
    - name: compliance-reporting
      team: legal-compliance
      usage: "AML/KYC monitoring and regulatory reporting"
    - name: transaction-audit-trail
      team: internal-audit
      usage: "Financial audit and forensic investigation support"
